<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tab Monitor - Document PiP</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 12px; width: 320px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        /* This is the element we will pop out */
        #monitor-window { 
            padding: 20px; 
            background: #1e1e1e; 
            color: white; 
            text-align: center;
            border-radius: 8px;
        }
        
        #alert-status { 
            height: 40px; 
            width: 100%; 
            background: #333; 
            margin-top: 10px; 
            line-height: 40px;
            border-radius: 4px;
        }

        .alert-active { background: #ff4444 !important; font-weight: bold; }

        button { width: 100%; padding: 10px; margin-top: 10px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; background: #bb86fc; color: black; }
        p { font-size: 11px; color: #aaa; }
    </style>
</head>
<body>

<div class="card">
    <h3>Tab Monitor</h3>
    <p>Using Native Document PiP</p>
    
    <div id="monitor-window">
        <div>System Status</div>
        <div id="alert-status">ALL CLEAR</div>
    </div>
    
    <button onclick="toggleDocPiP()">OPEN FLOATING WINDOW</button>
    <button onclick="simulateAlert()" style="background:#03dac6; margin-top:20px;">TEST ALERT</button>
</div>

<script>
    let pipWindow = null;
    const monitorContainer = document.getElementById('monitor-window');
    const statusBox = document.getElementById('alert-status');

    async function toggleDocPiP() {
        // 1. If PiP is already open, focus it or close it
        if (pipWindow) {
            pipWindow.close();
            return;
        }

        // 2. Request the document PiP window
        pipWindow = await window.documentPictureInPicture.requestWindow({
            width: 300,
            height: 200,
        });

        // 3. Move the monitor element into the new window
        pipWindow.document.body.append(monitorContainer);

        // 4. Copy styles to the new window so it looks the same
        const style = document.createElement('style');
        style.textContent = `
            body { 
                background: #121212; 
                color: white; 
                font-family: sans-serif; 
                display: flex; 
                justify-content: center; 
                align-items: center; 
                height: 100vh; 
                margin: 0; 
            }
            #monitor-window { text-align: center; width: 90%; }
            #alert-status { 
                height: 50px; 
                line-height: 50px; 
                background: #333; 
                border-radius: 8px; 
                margin-top: 10px;
            }
            .alert-active { background: #ff4444 !important; color: white; }
        `;
        pipWindow.document.head.append(style);

        // 5. Clean up when window is closed
        pipWindow.addEventListener("pagehide", () => {
            document.querySelector('.card').prepend(monitorContainer);
            pipWindow = null;
        });
    }

    // Function to change the UI based on your logic
    function simulateAlert() {
        statusBox.classList.add('alert-active');
        statusBox.innerText = "⚠️ WARNING!";
        
        // Reset after 3 seconds
        setTimeout(() => {
            statusBox.classList.remove('alert-active');
            statusBox.innerText = "ALL CLEAR";
        }, 3000);
    }
</script>

</body>
</html>
